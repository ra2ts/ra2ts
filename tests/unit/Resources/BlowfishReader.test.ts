import { expect, test } from 'vitest';
import { BlowfishReader } from '@/Resources/BlowfishReader';
import NodeForge from 'node-forge';

test('test key decrypts', () => {
  const key = "D1yVMBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBgYGBjdHefLu7u7u7u7u7u7u7u7u7u7u7u7u7s=";
  const data = new Uint8Array([
    0xB2, 0x86, 0xA8, 0x2A, 0xA5, 0x4F, 0xAA, 0xDE, 0xC9, 0x34, 0xF1, 0xCA,
    0x80, 0xEE, 0x5E, 0x83, 0x9C, 0x3F, 0x69, 0xC1, 0xB5, 0xA6, 0x5A, 0xAD,
    0xD2, 0x9E, 0x5A, 0xCD, 0xDE, 0x29, 0x8C, 0xE0, 0x06, 0xEC, 0x6D, 0x24,
    0xE2, 0xDC, 0x69, 0x3C, 0x3F, 0x67, 0x97, 0x07, 0x17, 0x81, 0xC9, 0xDD,
  ]);
  
  const reader = new BlowfishReader(data, NodeForge.util.decode64(key));
  expect(reader.readUint16()).toBe(6);
  expect(reader.readUint32()).toBe(53115856);
  expect(reader.readUint32()).toBe(0xAD29ACFA);
  reader.seek(0);
  expect(reader.readUint16()).toBe(6);
});
